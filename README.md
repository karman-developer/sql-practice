## IN / EXISTS

| 比較軸            | `IN`                     | `EXISTS`            |
| -------------- | ------------------------ | ------------------- |
| 比較対象           | **値の一覧**（1列のリスト）         | **行の存在**            |
| 処理内容           | \*\*結果の中に含まれるか？\*\*をチェック | **1件でも結果が出ればTRUE**  |
| 適しているケース       | 少量の結果 / 単純なチェック          | 大量データ / 存在判定だけしたい場合 |
| パフォーマンス（※DB依存） | 遅くなりがち（特に大規模データ）         | より高速なことが多い          |

## 判断基準

| 状況                     | 適した方     | 理由                        |
| ---------------------- | -------- | ------------------------- |
| 結果が小さいリスト              | `IN`     | シンプルで可読性が高い               |
| 存在チェックだけしたい（パフォーマンス重視） | `EXISTS` | インデックスを使って高速になる場合あり       |
| 結果が多い（大量の行）            | `EXISTS` | `IN`はメモリにリストを保持するため遅くなりがち |

### 練習問題（目標：3000本ノック）

✅ IN / EXISTS 練習問題
🔰【問題1】IN（基本）
questsに参加したことがあるメンバーの名前を取得してください。

🔰【問題2】IN + サブクエリ（GROUP BYあり）
2回以上クエストに参加したメンバーの名前を取得してください。

🟡【問題3】NOT IN
クエストに1度も参加したことがないメンバーの名前を取得してください。

🟡【問題4】EXISTS（基本）
参加履歴のあるメンバーの名前を取得してください。（INを使わずに）

🟡【問題5】NOT EXISTS
クエストに参加したことのないメンバーの名前を取得してください。（INを使わずに）

🔵【問題6】EXISTS + 複数条件
「魔法使い」で、なおかつクエストに成功したことがあるメンバーの名前を取得してください。

🔵【問題7】EXISTSネスト（上級）
参加履歴のあるメンバーのうち、参加したクエストの中に「魔獣の討伐」が含まれていたメンバーの名前を取得してください。

✅ 「IN」「EXISTS」を使った新しい問題
🔸問題1：
クエスト「秘宝の探求」に参加したメンバーの名前を取得せよ。
（IN を使っても EXISTS を使ってもOK）

🔸問題2：
どのクエストにも参加していないメンバーの名前を取得せよ。
（NOT IN または NOT EXISTS）

🔸問題3：
2回以上クエストに参加したことのあるメンバーの名前を取得せよ。
（IN (SELECT member_id ... GROUP BY ... HAVING COUNT >= 2) を使う）

🔸問題4：
「気絶」状態のメンバーの名前を、EXISTS を使って抽出せよ。
※ statuses テーブルと結合しなくても、サブクエリで名前からIDを抽出可能。

🔸問題5：
自分の職業の人が2人以上いる場合、そのメンバーの名前を表示せよ。
（IN (SELECT job_id FROM members GROUP BY job_id HAVING COUNT(*) >= 2) を利用）

🏭 生産管理の現場でありがちなSQL処理
👇よくあるデータモデル（例）
テーブル名	用途
orders	生産オーダー（指示）
products	製品マスタ
processes	工程
work_logs	実績ログ（誰が、いつ、どの工程を処理したか）
defects	不良情報
materials	材料表（BOM）

✅ GROUP BY & HAVING 練習問題
【問題1】職業ごとのメンバー人数を数えてください。
出力：職業名, 人数

条件：人数が2人以上の職業のみ表示してください。

使用テーブル：members, jobs

【問題2】クエストごとの参加人数を数えてください。
出力：クエスト名, 参加人数

条件：参加人数が1人のみのクエストを表示してください。

使用テーブル：participates, quests

【問題3】各メンバーの参加回数を表示してください。
出力：メンバー名, 参加回数

条件：3回以上参加しているメンバーのみ表示してください。

【問題4】成功率が50%以上のメンバーを抽出してください。
出力：メンバー名, 成功回数, 参加回数

条件：成功回数 ÷ 参加回数 >= 0.5

※ result が TRUE の件数が成功

【問題5】各状態（status）ごとの平均HPを求めてください。
出力：状態名, 平均HP

条件：平均HPが100以上の状態のみ

【問題6】職業ごとの最大MPを表示してください。
出力：職業名, 最大MP

条件なし

【問題7】各クエストに何人の異なる職業のメンバーが参加しているか表示してください。
出力：クエスト名, 職業の種類数

条件：職業の種類数が2種類以上のみ表示

使用テーブル：members, participates, quests, jobs

【チャレンジ問題】
状態ごとの職業の平均HPを表示してください。

出力：状態名, 職業名, 平均HP

条件：平均HPが80以上の組み合わせのみ

🔢 GROUP BY & HAVING 実践問題
🔹【問題 1】
各職業ごとの平均 HP を表示してください。

表示列：職業名、平均 HP

平均 HP が高い順に並べてください。

🔹【問題 2】
各状態ごとのメンバー数をカウントしてください。ただし、2人以上いる状態のみ表示してください。

表示列：状態名、人数

HAVING を使って絞り込むこと。

🔹【問題 3】
クエストごとの参加者数を表示してください。ただし、参加者が3人以上のクエストのみ表示してください。

表示列：クエスト名、参加者数

並び順：参加者数が多い順

🔹【問題 4】
職業ごとの最大 MP を表示してください。ただし、最大 MP が100以上の職業に限定してください。

表示列：職業名、最大 MP

NULL職業（無職）の場合は「無職」として表示してください。

🔹【問題 5（応用）】
状態ごとにクエスト参加回数が2回以上のメンバー数をカウントしてください。

表示列：状態名、条件に当てはまるメンバー数

GROUP BY、HAVING、JOIN を適切に組み合わせてください。

🔹【ボーナス問題】
メンバーごとに「クエスト成功率（成功回数 ÷ 全参加回数）」を算出し、成功率が80%以上のメンバーだけを表示してください。

 JOIN × GROUP BY × HAVING × サブクエリ（IN/EXISTS） の総合力を問う構成

✅【問題1】
状態ごとに、「平均HP」がもっとも高い状態トップ3を表示してください。

表示列：状態名、平均HP

状態が設定されていないメンバーも含めてください（＝LEFT JOIN）

NULL状態は「無状態」と表示してください

平均HPが高い順に並べ、上位3件のみ表示してください

✅【問題2】
クエストごとに、成功率が50%以上のクエスト名とその成功率（％）を表示してください。

表示列：クエスト名、成功率（小数第2位まで）

成功率 = 成功回数 / 総挑戦回数

成功かどうかは participates.result = true

参加履歴があるクエストのみ（成功率ゼロのものは除外）

✅【問題3】
職業ごとの平均 MP を表示してください。ただし、参加回数が2回以上のメンバーに限定してください。

表示列：職業名、平均MP

職業未設定のメンバーは「無職」と表示

参加回数（クエスト）が2回以上のメンバーのみ対象

✅【問題4】
「最も多くのメンバーが挑戦したクエスト」を1件だけ抽出してください。

表示列：クエスト名、挑戦したメンバー数

複数クエストが同数の場合はすべて表示

GROUP BY・サブクエリ使用

✅【問題5（応用）】
状態ごとに、「成功率50%以上のメンバー数」をカウントしてください。

表示列：状態名、条件を満たすメンバー数

成功率 = 成功回数 / 総挑戦回数（50%以上）

状態未設定メンバーも含めて表示

状態名がNULLの場合は「無状態」とする
